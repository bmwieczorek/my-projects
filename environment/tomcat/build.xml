<project name="MyProject" default="build" basedir=".">
    <description>Build base catalina from scratch</description>
    <!-- set global properties for this build -->
    <property name="tomcat.version" value="6.0.26"/>
    <property name="catalina.home" location="apache-tomcat-${tomcat.version}"/>
    <property name="catalina.base" location="DEV-catalina-base"/>
    <property name="catalina.pid" location="${catalina.base}/catalina.pid"/>
    <property name="tomcat.archive" location="${basedir}/../../apache-tomcat-${tomcat.version}.zip"/>

    <target name="build" description="build catalina base" >
        <unzip src="${tomcat.archive}" dest="${basedir}" />
        <mkdir dir="${catalina.base}" />
        <mkdir dir="${catalina.base}/bin" />
        <mkdir dir="${catalina.base}/conf" />
        <mkdir dir="${catalina.base}/logs" />
        <mkdir dir="${catalina.base}/temp" />
        <mkdir dir="${catalina.base}/webapps" />
        <mkdir dir="${catalina.base}/work" />
        <copy file="${catalina.home}/conf/server.xml" todir="${catalina.base}/conf"/>
        <copy file="${catalina.home}/conf/web.xml" todir="${catalina.base}/conf"/>
        <copy todir="${catalina.base}/webapps/ROOT">
            <fileset dir="${catalina.home}/webapps/ROOT"/>
        </copy>
        <echo file="${catalina.base}/conf/tomcat-users.xml" ><![CDATA[<?xml version='1.0' encoding='utf-8'?>
<tomcat-users>
    <role rolename="manager"/>
    <user username="admin" password="" roles="manager"/>
</tomcat-users>]]>
        </echo>
        <echo file="${catalina.base}/conf/Catalina/localhost/manager.xml" ><![CDATA[<?xml version='1.0' encoding='utf-8'?>
<Context docBase="$${catalina.home}/webapps/manager" privileged="true" antiResourceLocking="false" />]]>
        </echo>
        <echo file="${catalina.base}/bin/startup.sh" >#!/bin/bash
export CATALINA_HOME="${catalina.home}"
export CATALINA_BASE="${catalina.base}"
export CATALINA_PID="${catalina.pid}"
"${CATALINA_HOME}"/bin/startup.sh
        </echo>
        <echo file="${catalina.base}/bin/shutdown.sh" >#!/bin/bash
export CATALINA_HOME="${catalina.home}"
export CATALINA_BASE="${catalina.base}"
export CATALINA_PID="${catalina.pid}"
"${CATALINA_HOME}"/bin/shutdown.sh
        </echo>
        <chmod dir="${catalina.base}/bin" perm="ugo+rx" includes="**/*.sh"/>
        <chmod dir="${catalina.home}/bin" perm="ugo+rx" includes="**/*.sh"/>
    </target>

    <target name="clean" description="clean up" >
        <delete dir="${catalina.home}"/>
        <delete dir="${catalina.base}"/>
    </target>
</project>


